<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 SQL | _main.knit</title>
  <meta name="description" content="This is my portfolio written in a Rbookdown." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 SQL | _main.knit" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is my portfolio written in a Rbookdown." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 SQL | _main.knit" />
  
  <meta name="twitter:description" content="This is my portfolio written in a Rbookdown." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="looking-into-reproducible-science.html"/>
<link rel="next" href="reproducing-an-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.31/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Portfolio Twan Samsom</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Portfolio Twan Samsom<span></span></a></li>
<li class="chapter" data-level="2" data-path="curriculum-vitae.html"><a href="curriculum-vitae.html"><i class="fa fa-check"></i><b>2</b> Curriculum Vitae<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="curriculum-vitae.html"><a href="curriculum-vitae.html#opleidingen"><i class="fa fa-check"></i><b>2.1</b> Opleidingen<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="curriculum-vitae.html"><a href="curriculum-vitae.html#werk"><i class="fa fa-check"></i><b>2.2</b> Werk<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="curriculum-vitae.html"><a href="curriculum-vitae.html#talen"><i class="fa fa-check"></i><b>2.3</b> Talen<span></span></a></li>
<li class="chapter" data-level="2.4" data-path="curriculum-vitae.html"><a href="curriculum-vitae.html#vaardigheden"><i class="fa fa-check"></i><b>2.4</b> Vaardigheden<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="learning-a-new-skill.html"><a href="learning-a-new-skill.html"><i class="fa fa-check"></i><b>3</b> Learning a New Skill<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="learning-a-new-skill.html"><a href="learning-a-new-skill.html#planning"><i class="fa fa-check"></i><b>3.1</b> Planning<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="learning-a-new-skill.html"><a href="learning-a-new-skill.html#planning-after-finding-dataset"><i class="fa fa-check"></i><b>3.2</b> Planning after finding Dataset<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="learning-a-new-skill.html"><a href="learning-a-new-skill.html#results"><i class="fa fa-check"></i><b>3.3</b> Results<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="learning-a-new-skill.html"><a href="learning-a-new-skill.html#evaluation"><i class="fa fa-check"></i><b>3.4</b> Evaluation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="looking-into-reproducible-science.html"><a href="looking-into-reproducible-science.html"><i class="fa fa-check"></i><b>4</b> Looking into Reproducible Science<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="looking-into-reproducible-science.html"><a href="looking-into-reproducible-science.html#per-and-polyfluoroalkyl-substances-activate-upr-pathway-induce-steatosis-and-fibrosis-in-liver-cells"><i class="fa fa-check"></i><b>4.1</b> Per‚Äê and polyfluoroalkyl substances activate UPR pathway, induce steatosis and fibrosis in liver cells<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="looking-into-reproducible-science.html"><a href="looking-into-reproducible-science.html#hormonal-correlates-of-pathogen-disgust-testing-the-compensatory-prophylaxis-hypothesis"><i class="fa fa-check"></i><b>4.2</b> Hormonal correlates of pathogen disgust: testing the compensatory prophylaxis hypothesis<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sql.html"><a href="sql.html"><i class="fa fa-check"></i><b>5</b> SQL<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="sql.html"><a href="sql.html#getting-the-data"><i class="fa fa-check"></i><b>5.1</b> Getting the data<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="sql.html"><a href="sql.html#tidy-the-data"><i class="fa fa-check"></i><b>5.2</b> Tidy the data<span></span></a></li>
<li class="chapter" data-level="5.3" data-path="sql.html"><a href="sql.html#using-sql-and-r-to-inspect-data"><i class="fa fa-check"></i><b>5.3</b> Using SQL and R to inspect data<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="sql.html"><a href="sql.html#gapminder"><i class="fa fa-check"></i><b>5.3.1</b> Gapminder<span></span></a></li>
<li class="chapter" data-level="5.3.2" data-path="sql.html"><a href="sql.html#flu"><i class="fa fa-check"></i><b>5.3.2</b> Flu<span></span></a></li>
<li class="chapter" data-level="5.3.3" data-path="sql.html"><a href="sql.html#dengue"><i class="fa fa-check"></i><b>5.3.3</b> Dengue<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="sql.html"><a href="sql.html#summarzing-flu-and-dengue"><i class="fa fa-check"></i><b>5.4</b> Summarzing flu and dengue<span></span></a></li>
<li class="chapter" data-level="5.5" data-path="sql.html"><a href="sql.html#merging-the-tables"><i class="fa fa-check"></i><b>5.5</b> Merging the tables<span></span></a></li>
<li class="chapter" data-level="5.6" data-path="sql.html"><a href="sql.html#creating-some-plots"><i class="fa fa-check"></i><b>5.6</b> Creating some plots<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reproducing-an-analysis.html"><a href="reproducing-an-analysis.html"><i class="fa fa-check"></i><b>6</b> Reproducing an Analysis<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="reproducing-an-analysis.html"><a href="reproducing-an-analysis.html#getting-the-data-1"><i class="fa fa-check"></i><b>6.1</b> Getting the data<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="reproducing-an-analysis.html"><a href="reproducing-an-analysis.html#normalizing-the-data"><i class="fa fa-check"></i><b>6.2</b> Normalizing the data<span></span></a></li>
<li class="chapter" data-level="6.3" data-path="reproducing-an-analysis.html"><a href="reproducing-an-analysis.html#visualizing-the-data"><i class="fa fa-check"></i><b>6.3</b> Visualizing the data<span></span></a></li>
<li class="chapter" data-level="6.4" data-path="reproducing-an-analysis.html"><a href="reproducing-an-analysis.html#normalizing-the-data-again"><i class="fa fa-check"></i><b>6.4</b> Normalizing the data again<span></span></a></li>
<li class="chapter" data-level="6.5" data-path="reproducing-an-analysis.html"><a href="reproducing-an-analysis.html#visualizing-the-data-again"><i class="fa fa-check"></i><b>6.5</b> Visualizing the data again<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="reproducing-an-analysis.html"><a href="reproducing-an-analysis.html#step-wise-plan-for-dose-response-curve-analysis"><i class="fa fa-check"></i><b>6.6</b> Step-wise Plan for Dose-Response Curve Analysis<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduction-to-projecticum.html"><a href="introduction-to-projecticum.html"><i class="fa fa-check"></i><b>7</b> Introduction to projecticum<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-projecticum.html"><a href="introduction-to-projecticum.html#introductie"><i class="fa fa-check"></i><b>7.1</b> Introductie<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-projecticum.html"><a href="introduction-to-projecticum.html#plasmiden"><i class="fa fa-check"></i><b>7.2</b> Plasmiden<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="introduction-to-projecticum.html"><a href="introduction-to-projecticum.html#one-health"><i class="fa fa-check"></i><b>7.3</b> One Health<span></span></a></li>
<li class="chapter" data-level="7.4" data-path="introduction-to-projecticum.html"><a href="introduction-to-projecticum.html#het-project"><i class="fa fa-check"></i><b>7.4</b> Het Project<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="r-package.html"><a href="r-package.html"><i class="fa fa-check"></i><b>8</b> R package<span></span></a></li>
<li class="chapter" data-level="9" data-path="guerrilla-analytics-framework.html"><a href="guerrilla-analytics-framework.html"><i class="fa fa-check"></i><b>9</b> Guerrilla Analytics Framework<span></span></a></li>
<li class="chapter" data-level="10" data-path="refrences.html"><a href="refrences.html"><i class="fa fa-check"></i><b>10</b> Refrences<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sql" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> SQL<a href="sql.html#sql" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>N.B. some of the steps are done using an connection to a local postgres database, because these wouldn‚Äôt work in an R markdown they are replaced by screenshots.</p>
<div id="getting-the-data" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Getting the data<a href="sql.html#getting-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First we need to get the data for the exercise, we use wget to download them from github.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="sql.html#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="sql.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Go to data_raw</span></span>
<span id="cb6-3"><a href="sql.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> sql/raw_data/ </span>
<span id="cb6-4"><a href="sql.html#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="sql.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the flu dataset</span></span>
<span id="cb6-6"><a href="sql.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-O</span> flu_data.csv https://raw.githubusercontent.com/DataScienceILC/tlsc-dsfb26v-20_workflows/main/data/flu_data.csv</span>
<span id="cb6-7"><a href="sql.html#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="sql.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the dengue dataset</span></span>
<span id="cb6-9"><a href="sql.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-O</span> dengue_data.csv https://raw.githubusercontent.com/DataScienceILC/tlsc-dsfb26v-20_workflows/main/data/dengue_data.csv</span></code></pre></div>
</div>
<div id="tidy-the-data" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Tidy the data<a href="sql.html#tidy-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Its important to make the data tidy so every table matches structure wise, in these steps we also make some changes to make merging later easier.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="sql.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load needed libraries</span></span>
<span id="cb7-2"><a href="sql.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb7-3"><a href="sql.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-4"><a href="sql.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgreSQL)</span>
<span id="cb7-5"><a href="sql.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="sql.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the different data</span></span>
<span id="cb8-2"><a href="sql.html#cb8-2" aria-hidden="true" tabindex="-1"></a>flu_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;sql/raw_data/flu_data.csv&quot;</span>, <span class="at">skip =</span> <span class="dv">11</span>) <span class="co"># skip = 11 to skip the first 11 lines which contain metadata</span></span>
<span id="cb8-3"><a href="sql.html#cb8-3" aria-hidden="true" tabindex="-1"></a>dengue_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;sql/raw_data/dengue_data.csv&quot;</span>, <span class="at">skip =</span> <span class="dv">11</span>)</span>
<span id="cb8-4"><a href="sql.html#cb8-4" aria-hidden="true" tabindex="-1"></a>gapminder_data <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(gapminder)</span>
<span id="cb8-5"><a href="sql.html#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="sql.html#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="sql.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">## flu_data</span></span>
<span id="cb8-8"><a href="sql.html#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Make flu_data tidy</span></span>
<span id="cb8-9"><a href="sql.html#cb8-9" aria-hidden="true" tabindex="-1"></a>tidy_flu_data <span class="ot">&lt;-</span> flu_data <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="sql.html#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">&quot;country&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span>)</span>
<span id="cb8-11"><a href="sql.html#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="sql.html#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Split Date into year, month, day</span></span>
<span id="cb8-13"><a href="sql.html#cb8-13" aria-hidden="true" tabindex="-1"></a>tidy_flu_data <span class="ot">&lt;-</span> tidy_flu_data <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="sql.html#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Date, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb8-15"><a href="sql.html#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="sql.html#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert year into factor</span></span>
<span id="cb8-17"><a href="sql.html#cb8-17" aria-hidden="true" tabindex="-1"></a>tidy_flu_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(tidy_flu_data<span class="sc">$</span>year)</span>
<span id="cb8-18"><a href="sql.html#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="sql.html#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># flu_data uses dots instead of spaces in country names (New.Zealand)</span></span>
<span id="cb8-20"><a href="sql.html#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># So to make joining the tables easier we need to replace the dots with spaces</span></span>
<span id="cb8-21"><a href="sql.html#cb8-21" aria-hidden="true" tabindex="-1"></a>tidy_flu_data<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="st">&quot; &quot;</span>, tidy_flu_data<span class="sc">$</span>country)</span>
<span id="cb8-22"><a href="sql.html#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="sql.html#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co"># turn country into factor</span></span>
<span id="cb8-24"><a href="sql.html#cb8-24" aria-hidden="true" tabindex="-1"></a>tidy_flu_data<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(tidy_flu_data<span class="sc">$</span>country)</span>
<span id="cb8-25"><a href="sql.html#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="sql.html#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co"># dengue_data</span></span>
<span id="cb8-27"><a href="sql.html#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Make dengue_data tidy</span></span>
<span id="cb8-28"><a href="sql.html#cb8-28" aria-hidden="true" tabindex="-1"></a>tidy_dengue_data <span class="ot">&lt;-</span> dengue_data <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="sql.html#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">&quot;country&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span>)</span>
<span id="cb8-30"><a href="sql.html#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="sql.html#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Split Date into year, month, day</span></span>
<span id="cb8-32"><a href="sql.html#cb8-32" aria-hidden="true" tabindex="-1"></a>tidy_dengue_data <span class="ot">&lt;-</span> tidy_dengue_data <span class="sc">%&gt;%</span></span>
<span id="cb8-33"><a href="sql.html#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Date, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb8-34"><a href="sql.html#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="sql.html#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert year into factor</span></span>
<span id="cb8-36"><a href="sql.html#cb8-36" aria-hidden="true" tabindex="-1"></a>tidy_dengue_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(tidy_dengue_data<span class="sc">$</span>year)</span>
<span id="cb8-37"><a href="sql.html#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="sql.html#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co"># turn country into factor</span></span>
<span id="cb8-39"><a href="sql.html#cb8-39" aria-hidden="true" tabindex="-1"></a>tidy_dengue_data<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(tidy_dengue_data<span class="sc">$</span>country)</span>
<span id="cb8-40"><a href="sql.html#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="sql.html#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="sql.html#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="sql.html#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Save tidy_dengue_data</span></span>
<span id="cb8-44"><a href="sql.html#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(tidy_dengue_data, <span class="st">&quot;sql/data/tidy_dengue_data.csv&quot;</span>)</span>
<span id="cb8-45"><a href="sql.html#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tidy_dengue_data, <span class="st">&quot;sql/data/tidy_dengue_data.rds&quot;</span>)</span>
<span id="cb8-46"><a href="sql.html#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="sql.html#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Save tidy_flu_data</span></span>
<span id="cb8-48"><a href="sql.html#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(tidy_flu_data, <span class="st">&quot;sql/data/tidy_flu_data.csv&quot;</span>)</span>
<span id="cb8-49"><a href="sql.html#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tidy_flu_data, <span class="st">&quot;sql/data/tidy_flu_data.rds&quot;</span>)</span>
<span id="cb8-50"><a href="sql.html#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="sql.html#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Save clean gapminder_data</span></span>
<span id="cb8-52"><a href="sql.html#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(gapminder_data, <span class="st">&quot;sql/data/tidy_gapminder_data.csv&quot;</span>)</span>
<span id="cb8-53"><a href="sql.html#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(gapminder_data, <span class="st">&quot;sql/data/tidy_gapminder_data.rds&quot;</span>)</span></code></pre></div>
<p>The chunck beneath is to create an connection object, that can be used to connect to a Postgres database.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="sql.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb9-2"><a href="sql.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgreSQL)</span>
<span id="cb9-3"><a href="sql.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb9-4"><a href="sql.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="sql.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create connection object to connect to local PostgreSQL database</span></span>
<span id="cb9-6"><a href="sql.html#cb9-6" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RPostgres<span class="sc">::</span><span class="fu">Postgres</span>(), </span>
<span id="cb9-7"><a href="sql.html#cb9-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dbname =</span> <span class="st">&quot;workflowsdb&quot;</span>, </span>
<span id="cb9-8"><a href="sql.html#cb9-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">host=</span><span class="st">&quot;localhost&quot;</span>, </span>
<span id="cb9-9"><a href="sql.html#cb9-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">port=</span><span class="st">&quot;5432&quot;</span>, </span>
<span id="cb9-10"><a href="sql.html#cb9-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">user=</span><span class="st">&quot;postgres&quot;</span>, </span>
<span id="cb9-11"><a href="sql.html#cb9-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">password=</span><span class="st">&quot;PASSWORD&quot;</span>)</span></code></pre></div>
<p>This chunck would normaly create tables in the postgres database.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="sql.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load tidy_flu_data into Postgres database</span></span>
<span id="cb10-2"><a href="sql.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">&quot;tidy_flu_data&quot;</span>, <span class="fu">as.data.frame</span>(tidy_flu_data), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-3"><a href="sql.html#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="sql.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load tidy_dengue_data into Postgres database</span></span>
<span id="cb10-5"><a href="sql.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">&quot;tidy_dengue_data&quot;</span>, <span class="fu">as.data.frame</span>(tidy_dengue_data), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-6"><a href="sql.html#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="sql.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load gapminder_data into Postgres database</span></span>
<span id="cb10-8"><a href="sql.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">&quot;gapminder_data&quot;</span>, <span class="fu">as.data.frame</span>(gapminder_data), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="using-sql-and-r-to-inspect-data" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Using SQL and R to inspect data<a href="sql.html#using-sql-and-r-to-inspect-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We use both SQL and R to inspect the data in the same way</p>
<div id="gapminder" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Gapminder<a href="sql.html#gapminder" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we order the gapminder data by life expactancy.
<img src="sql/images/SQL_example_gapminder.png" alt="Using SQL to order the gapminder data by life expectancy" />
Using R with the same goal.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="sql.html#cb11-1" aria-hidden="true" tabindex="-1"></a>gapminder_data <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="sql.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(life_expectancy))</span></code></pre></div>
<pre><code>## # A tibble: 10,545 √ó 9
##    country      year infant_mortality life_expectancy fertility population   gdp
##    &lt;fct&gt;       &lt;int&gt;            &lt;dbl&gt;           &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1 Hong Kong,‚Ä¶  2016             NA              83.9     NA            NA    NA
##  2 Hong Kong,‚Ä¶  2015             NA              83.7      1.17    7287983    NA
##  3 Hong Kong,‚Ä¶  2014             NA              83.6      1.15    7226869    NA
##  4 Hong Kong,‚Ä¶  2013             NA              83.4      1.14    7163930    NA
##  5 Iceland      2014              1.6            83.3      2.07     327318    NA
##  6 Iceland      2015              1.6            83.3      2.06     329425    NA
##  7 Iceland      2016             NA              83.3     NA            NA    NA
##  8 Japan        2016             NA              83.3     NA            NA    NA
##  9 Hong Kong,‚Ä¶  2012             NA              83.2      1.12    7101858    NA
## 10 Iceland      2013              1.6            83.2      2.08     325392    NA
## # ‚Ä¶ with 10,535 more rows, and 2 more variables: continent &lt;fct&gt;, region &lt;fct&gt;</code></pre>
</div>
<div id="flu" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Flu<a href="sql.html#flu" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we select only the cases in France from the flu data.
<img src="sql/images/SQL_example_flu.png" alt="Using SQL to select only the cases in France in the flu data" />
Again using R for the same goal.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="sql.html#cb13-1" aria-hidden="true" tabindex="-1"></a>tidy_flu_data <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="sql.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">tolower</span>(country) <span class="sc">==</span> <span class="st">&#39;france&#39;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(cases)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="sql.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, month, day)</span></code></pre></div>
<pre><code>## # A tibble: 620 √ó 5
##    year  month day   country cases
##    &lt;fct&gt; &lt;chr&gt; &lt;chr&gt; &lt;fct&gt;   &lt;int&gt;
##  1 2003  09    28    France     25
##  2 2003  10    05    France     25
##  3 2003  10    12    France     30
##  4 2003  10    19    France     81
##  5 2003  10    26    France     82
##  6 2003  11    02    France     48
##  7 2003  11    09    France    146
##  8 2003  11    16    France    274
##  9 2003  11    23    France    877
## 10 2003  11    30    France   1282
## # ‚Ä¶ with 610 more rows</code></pre>
</div>
<div id="dengue" class="section level3 hasAnchor" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Dengue<a href="sql.html#dengue" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we sort dengue by cases from high to low.
<img src="sql/images/SQL_example_dengue.png" alt="Using SQL to sort dengue by cases" />
And again R for the same goal.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="sql.html#cb15-1" aria-hidden="true" tabindex="-1"></a>tidy_dengue_data <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="sql.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cases)) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="sql.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(cases))</span></code></pre></div>
<pre><code>## # A tibble: 6,263 √ó 5
##    year  month day   country     cases
##    &lt;fct&gt; &lt;chr&gt; &lt;chr&gt; &lt;fct&gt;       &lt;dbl&gt;
##  1 2004  02    29    Indonesia       1
##  2 2005  09    11    Singapore       1
##  3 2008  04    06    Brazil          1
##  4 2009  02    08    Bolivia         1
##  5 2009  05    03    Argentina       1
##  6 2009  09    27    Mexico          1
##  7 2010  05    30    Venezuela       1
##  8 2010  08    29    Philippines     1
##  9 2012  10    21    India           1
## 10 2013  07    14    Thailand        1
## # ‚Ä¶ with 6,253 more rows</code></pre>
<p>Here you can see that in every country, the highest case is 1 because the data is relative per country. The day where there were the most Google searches about dengue is labeled as one, and the day with the fewest is labeled as 0. Every other day is on the scale between those.</p>
</div>
</div>
<div id="summarzing-flu-and-dengue" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Summarzing flu and dengue<a href="sql.html#summarzing-flu-and-dengue" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Both the flu and dengue data have datapoints every day, while gapminder has a datapoint for every year. Before we can join flu and dengue with gapminder we first have to summarize the data so flu and dengue to have a datapoint for every year.</p>
<p>For flu we can just take the total of every case, hence we use sum in the summarize function.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="sql.html#cb17-1" aria-hidden="true" tabindex="-1"></a>summarized_flu_data <span class="ot">&lt;-</span> tidy_flu_data <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="sql.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(year, month, day, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="sql.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="sql.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_cases_flu =</span> <span class="fu">sum</span>(cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="sql.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>For dengue, we need to calculate the average because the data is on a scale where 1 represents the highest search activity in a country, and 0 represents the lowest. Therefore, we use the mean function in the summarize function.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="sql.html#cb18-1" aria-hidden="true" tabindex="-1"></a>summarized_dengue_data <span class="ot">&lt;-</span> tidy_dengue_data <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="sql.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(year, month, day, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="sql.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="sql.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_cases_dengue =</span> <span class="fu">mean</span>(cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="sql.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Now we load the new summarized files into the database.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="sql.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load summarized_flu_data</span></span>
<span id="cb19-2"><a href="sql.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">&quot;summarized_flu_data&quot;</span>, <span class="fu">as.data.frame</span>(summarized_flu_data), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-3"><a href="sql.html#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="sql.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load summarized_dengue_data</span></span>
<span id="cb19-5"><a href="sql.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="st">&quot;summarized_dengue_data&quot;</span>, <span class="fu">as.data.frame</span>(summarized_dengue_data), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="merging-the-tables" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Merging the tables<a href="sql.html#merging-the-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Normally this could be used to merge the tables and load the table into R.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="sql.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SQL to merge tables</span></span>
<span id="cb20-2"><a href="sql.html#cb20-2" aria-hidden="true" tabindex="-1"></a>sql_query <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb20-3"><a href="sql.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT</span></span>
<span id="cb20-4"><a href="sql.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(d.country, f.country) AS merged_country,</span></span>
<span id="cb20-5"><a href="sql.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(d.year, f.year::text) AS merged_year,</span></span>
<span id="cb20-6"><a href="sql.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="st">    d.avg_cases_dengue,</span></span>
<span id="cb20-7"><a href="sql.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="st">    f.total_cases_flu,</span></span>
<span id="cb20-8"><a href="sql.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="st">    g.*</span></span>
<span id="cb20-9"><a href="sql.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="st">FROM</span></span>
<span id="cb20-10"><a href="sql.html#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="st">    summarized_dengue_data AS d</span></span>
<span id="cb20-11"><a href="sql.html#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="st">FULL JOIN</span></span>
<span id="cb20-12"><a href="sql.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="st">    summarized_flu_data AS f ON d.year = f.year::text AND d.country = f.country</span></span>
<span id="cb20-13"><a href="sql.html#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN</span></span>
<span id="cb20-14"><a href="sql.html#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">    gapminder_data AS g ON COALESCE(d.year, f.year::text) = g.year::text AND COALESCE(d.country, f.country) = g.country</span></span>
<span id="cb20-15"><a href="sql.html#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY</span></span>
<span id="cb20-16"><a href="sql.html#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="st">    COALESCE(d.avg_cases_dengue, 0) DESC, COALESCE(f.total_cases_flu, 0) DESC;</span></span>
<span id="cb20-17"><a href="sql.html#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb20-18"><a href="sql.html#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Export table to R</span></span>
<span id="cb20-19"><a href="sql.html#cb20-19" aria-hidden="true" tabindex="-1"></a>merged_table <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, sql_query)</span>
<span id="cb20-20"><a href="sql.html#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(merged_table)</span></code></pre></div>
<p>Because we can‚Äôt use SQL we just load the merged table in using R, and create a summary of the data.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="sql.html#cb21-1" aria-hidden="true" tabindex="-1"></a>merged_table <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;sql/data/merged_table.rds&quot;</span>)</span>
<span id="cb21-2"><a href="sql.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(merged_table)</span></code></pre></div>
<pre><code>##  merged_country     merged_year        avg_cases_dengue total_cases_flu 
##  Length:490         Length:490         Min.   :0.0108   Min.   :     0  
##  Class :character   Class :character   1st Qu.:0.0796   1st Qu.:  1696  
##  Mode  :character   Mode  :character   Median :0.1216   Median :  6772  
##                                        Mean   :0.1363   Mean   : 20147  
##                                        3rd Qu.:0.1772   3rd Qu.: 24975  
##                                        Max.   :0.5355   Max.   :155577  
##                                        NA&#39;s   :360      NA&#39;s   :84      
##    country               year      infant_mortality life_expectancy
##  Length:490         Min.   :2002   Min.   : 2.00    Min.   :52.50  
##  Class :character   1st Qu.:2005   1st Qu.: 4.00    1st Qu.:73.20  
##  Mode  :character   Median :2008   Median : 7.60    Median :76.50  
##                     Mean   :2008   Mean   :12.61    Mean   :75.84  
##                     3rd Qu.:2012   3rd Qu.:15.88    3rd Qu.:80.50  
##                     Max.   :2015   Max.   :62.00    Max.   :83.20  
##                                                                    
##    fertility       population             gdp             continent        
##  Min.   :1.150   Min.   :3.324e+06   Min.   :7.214e+09   Length:490        
##  1st Qu.:1.430   1st Qu.:9.241e+06   1st Qu.:8.430e+10   Class :character  
##  Median :1.850   Median :3.001e+07   Median :2.193e+11   Mode  :character  
##  Mean   :1.945   Mean   :8.865e+07   Mean   :7.992e+11                     
##  3rd Qu.:2.288   3rd Qu.:8.051e+07   3rd Qu.:5.853e+11                     
##  Max.   :3.980   Max.   :1.311e+09   Max.   :1.174e+13                     
##                                      NA&#39;s   :141                           
##     region         
##  Length:490        
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
## </code></pre>
</div>
<div id="creating-some-plots" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Creating some plots<a href="sql.html#creating-some-plots" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We now use the merged table to create some plots to visualize the data.</p>
<p>Create boxplot of life expectancy per continent.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="sql.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb23-2"><a href="sql.html#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="sql.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of Life Expectancy by Continent</span></span>
<span id="cb23-4"><a href="sql.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_table, <span class="fu">aes</span>(<span class="at">x =</span> continent, <span class="at">y =</span> life_expectancy, <span class="at">fill =</span> continent)) <span class="sc">+</span></span>
<span id="cb23-5"><a href="sql.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb23-6"><a href="sql.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Boxplot of Life Expectancy by Continent&quot;</span>,</span>
<span id="cb23-7"><a href="sql.html#cb23-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Continent&quot;</span>,</span>
<span id="cb23-8"><a href="sql.html#cb23-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Life Expectancy&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-9"><a href="sql.html#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-10"><a href="sql.html#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Continent&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Linegraph for dengue cases in Brazil, Argentina and Bolivia.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="sql.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chosen 3 random countries</span></span>
<span id="cb24-2"><a href="sql.html#cb24-2" aria-hidden="true" tabindex="-1"></a>selected_countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Brazil&quot;</span>, <span class="st">&quot;Argentina&quot;</span>, <span class="st">&quot;Bolivia&quot;</span>)</span>
<span id="cb24-3"><a href="sql.html#cb24-3" aria-hidden="true" tabindex="-1"></a>filtered_data_dengue <span class="ot">&lt;-</span> merged_table[merged_table<span class="sc">$</span>country <span class="sc">%in%</span> selected_countries, ]</span>
<span id="cb24-4"><a href="sql.html#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="sql.html#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Line plot of Dengue cases for Brazil, Argentina and Bolivia</span></span>
<span id="cb24-6"><a href="sql.html#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(filtered_data_dengue, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> avg_cases_dengue, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb24-7"><a href="sql.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb24-8"><a href="sql.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Dengue Cases Over the Years (Selected Countries)&quot;</span>,</span>
<span id="cb24-9"><a href="sql.html#cb24-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb24-10"><a href="sql.html#cb24-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Average Dengue Cases&quot;</span>,</span>
<span id="cb24-11"><a href="sql.html#cb24-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Country&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-12"><a href="sql.html#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values (`geom_line()`).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Flu cases per capita per country.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="sql.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to exclude NA values</span></span>
<span id="cb26-2"><a href="sql.html#cb26-2" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> merged_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_cases_flu) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(population))</span>
<span id="cb26-3"><a href="sql.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="sql.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide the cases by the population</span></span>
<span id="cb26-5"><a href="sql.html#cb26-5" aria-hidden="true" tabindex="-1"></a>filtered_data<span class="sc">$</span>flu_ratio <span class="ot">&lt;-</span> filtered_data<span class="sc">$</span>total_cases_flu <span class="sc">/</span> filtered_data<span class="sc">$</span>population</span>
<span id="cb26-6"><a href="sql.html#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="sql.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a box plot</span></span>
<span id="cb26-8"><a href="sql.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(filtered_data, <span class="fu">aes</span>(<span class="at">x =</span> merged_country, <span class="at">y =</span> flu_ratio)) <span class="sc">+</span></span>
<span id="cb26-9"><a href="sql.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb26-10"><a href="sql.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribution of Flu Cases per Population per Country&quot;</span>,</span>
<span id="cb26-11"><a href="sql.html#cb26-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb26-12"><a href="sql.html#cb26-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Flu Cases per Population&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-13"><a href="sql.html#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-14"><a href="sql.html#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))  <span class="co"># Make readable</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>In this graph we can see in what countries Flu is most common.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="looking-into-reproducible-science.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reproducing-an-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/05-SQL.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"collapse": "section"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
